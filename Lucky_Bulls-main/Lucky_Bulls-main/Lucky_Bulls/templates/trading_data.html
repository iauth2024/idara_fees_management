{% extends 'base.html' %}
{% load custom_filters %}

{% block content %}
<div class="container my-4">
    <h2 class="text-center mb-4">Trading Dashboard</h2>
    
    <!-- Fund Limits -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4>Fund Limits</h4>
            
        </div>
        <div class="card-body">
            {% if master_account %}
                <h5 class="text-primary"><strong>Master Account:</strong> {{ master_account.name }}</h5>
                <p><strong>Client ID:</strong> {{ master_account.client_id }}</p>
                <p class="bg-success text-white p-2 rounded font-weight-bold">
                    <strong>Available Balance:</strong> ₹{{ master_account.fund_limits|default:"0" }}
                </p>
            {% endif %}
            
            {% for account in child_accounts %}
                <hr>
                <h5 class="{% cycle 'text-warning' 'text-danger' 'text-success' %}"><strong>{{ account.name }}</strong></h5>
                <p><strong>Client ID:</strong> {{ account.client_id }}</p>
                <p class="bg-success text-white p-2 rounded font-weight-bold">
                    <strong>Available Balance:</strong> ₹{{ account.fund_limits|default:"0" }}
                </p>
            {% endfor %}
        </div>
    </div>
    
    <!-- Orders -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-info text-white">
            <h4>Orders</h4>
        </div>
        <div class="card-body">
            <table class="table table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>Account</th>
                        <th>Symbol</th>
                        <th>Order Type</th>
                        <th>Transaction Type</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if master_account and master_account.orders %}
                        {% for order in master_account.orders %}
                            <tr class="bg-primary text-white">
                                <td>Master</td>
                                <td>{{ order.tradingSymbol|default:"" }}</td>
                                <td>{{ order.orderType|default:"" }}</td>
                                <td>{{ order.transactionType|default:"" }}</td>
                                <td>{{ order.quantity|default:0 }}</td>
                                <td>₹{{ order.price|default:0 }}</td>
                                <td><span class="badge bg-warning">{{ order.orderStatus|default:"" }}</span></td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                    
                    {% for account in child_accounts %}
                        {% for order in account.orders %}
                            <tr class="{% cycle 'bg-warning' 'bg-danger text-white' 'bg-success text-white' %}">
                                <td>{{ account.name }}</td>
                                <td>{{ order.tradingSymbol|default:"" }}</td>
                                <td>{{ order.transactionType|default:"" }}</td>
                                <td>{{ order.orderType|default:"" }}</td>
                                <td>{{ order.quantity|default:0 }}</td>
                                <td>₹{{ order.price|default:0 }}</td>
                                <td><span class="badge bg-warning">{{ order.orderStatus|default:"" }}</span></td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Positions -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-success text-white">
            <h4>Positions</h4>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Account</th>
                        <th>Symbol</th>
                        <th>Buy Qty</th>
                        <th>Sell Qty</th>
                        <th>Realized Profit</th>
                        <th>Unrealized Profit</th>
                    </tr>
                </thead>
                <tbody>
                    {% if master_account and master_account.positions %}
                        {% for position in master_account.positions %}
                            <tr class="bg-primary text-white">
                                <td>Master</td>
                                <td>{{ position|get_item:"tradingSymbol"|default:"-" }}</td>
                                <td>{{ position|get_item:"buyQty"|default:0 }}</td>
                                <td>{{ position|get_item:"sellQty"|default:0 }}</td>
                                <td class="text-success">₹{{ position|get_item:"realizedProfit"|default:0 }}</td>
                                <td class="text-danger">₹{{ position|get_item:"unrealizedProfit"|default:0 }}</td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                    
                    {% for account in child_accounts %}
                        {% for position in account.positions %}
                            <tr class="{% cycle 'bg-warning' 'bg-danger text-white' 'bg-success text-white' %}">
                                <td>{{ account.name }}</td>
                                <td>{{ position|get_item:"tradingSymbol"|default:"-" }}</td>
                                <td>{{ position|get_item:"buyQty"|default:0 }}</td>
                                <td>{{ position|get_item:"sellQty"|default:0 }}</td>
                                <td class="text-success">₹{{ position|get_item:"realizedProfit"|default:0 }}</td>
                                <td class="text-danger">₹{{ position|get_item:"unrealizedProfit"|default:0 }}</td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Holdings -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-secondary text-white">
            <h4>Holdings</h4>
        </div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Account</th>
                        <th>Symbol</th>
                        <th>Total Quantity</th>
                        <th>Avg Cost Price</th>
                        
                    </tr>
                </thead>
                <tbody>
                    {% if master_account and master_account.holdings %}
                        {% for holding in master_account.holdings %}
                            <tr class="bg-primary text-white">
                                <td>Master</td>
                                <td>{{ holding|get_item:"Symbol"|default:"-" }}</td>
                                <td>{{ holding|get_item:"Total Quantity"|default:0 }}</td>
                                <td>₹{{ holding|get_item:"Average Cost Price"|default:0 }}</td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                    
                    {% for account in child_accounts %}
                        {% for holding in account.holdings %}
                            <tr class="{% cycle 'bg-warning' 'bg-danger text-white' 'bg-success text-white' %}">
                                <td>{{ account.name }}</td>
                                <td>{{ holding|get_item:"Symbol"|default:"-" }}</td>
                                <td>{{ holding|get_item:"Total Quantity"|default:0 }}</td>
                                <td>₹{{ holding|get_item:"Average Cost Price"|default:0 }}</td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
